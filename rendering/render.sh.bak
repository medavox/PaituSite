#to do:
#add functionality to check whether lastinput version is the same as mdfiles version, and only overwrite and re-render with the (obviously newer) mdfiles version if they're different
#create copies of .md files with space in filenames removed
#keeping the .md version we rendered will help later with checking which files have changed and need re-rendering

shopt -s extglob ##enable better bash regex support, ie for the ?(pattern) below
cd ../mdfiles
for f in *?(\ )*; do
	g="${f// /_}" # replace spaces with underscores in filenames
	dift=$(diff -qN "$f" ../lastinput/${g,,})
	if [ -n "$dift" ]; then # if working copy in ../mdfiles/ differs from last rendered version in ../lastinput/
		#echo $f HAS CHANGED!
		echo copying $f to ../temp/${g,,} #make the name lowercase as well
		cp "$f" ../temp/"${g,,}" # copy changed files to ../temp/ for rendering, in the next loop
	fi

done

#render updated files in ../temp/ to html
for x in $(ls ../temp) ; do
	echo rendering $x to ${x%md}html
	pandoc -c ../styles/style.css --toc -s -r markdown+pipe_tables -w html -o ../html/${x%md}html ../temp/$x
	mv ../temp/$x ../lastinput/$x
done
